#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

dmenufont='Cousine Nerd Font Mono:pixelsize=20:antialias=true:autohint=true'
dir_university="$HOME/university/"
course_root="$dir_university/this-year/current-semester/"
current_course='current-course'
course_target="$dir_university"/"$current_course"

if [ -e "$course_target" ]; then
    current_course=$(cat "$course_target"/info.json | jq '.title')
    notify-send "Current course: ${current_course}"
else
    notify-send "Current course doesn't exist."
fi

course_chosen=$(ls "$course_root" |\
    dmenu -l 15 -fn "$dmenufont")

if [ -n "$course_chosen" ]; then
    # remove previously linked dir
    if [ -e "$course_target" ]; then
        rm "$course_target"
    fi
    ln -s "$course_root"/"$course_chosen" "$dir_university"
    mv "$dir_university"/"$course_chosen" "$course_target"
    notify-send "${course_chosen} linked."
else
    notify-send "Linking canceled."
fi
