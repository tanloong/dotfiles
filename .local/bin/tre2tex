#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

input="${1}"
output="${1%.*}".tex
tree=$(sed -E -e 's/\(\W[^)]*\)//g; s/\(([A-Z]+)/[\.\1/g; s/\)/ ]/g; s/^/\\Tree /; s/\$/\\\$/g; s/%/\\%/g; s/&/\\&/g' "$input" | tr -s ' ')
# delete punctuation marks,
# convert parentheses into sqaure brackets,
# add '\Tree' at the beginning of the line,
# escape dolloar sign

preamble='\documentclass[a4paper]{article}
\usepackage{qtree}
\usepackage{adjustbox}
\begin{document}'
adjustbox_begin='\begin{adjustbox}{width={\textwidth},totalheight={\textheight},keepaspectratio}'
adjustbox_end='\end{adjustbox}'
last='\end{document}'

echo "$preamble" > "$output"
for line in $tree; do
    echo "$adjustbox_begin" >> "$output"
    echo "$line" >> "$output"
    echo "$adjustbox_end" >> "$output"
done
echo "$last" >> "$output"

xelatex "$output"
zathura "${output%.*}".pdf
